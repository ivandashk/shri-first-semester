{"version":3,"sources":["video-page.js","sidebar.js"],"names":["initVideo","video","url","Hls","isSupported","hls","loadSource","attachMedia","on","Events","MANIFEST_PARSED","play","isActive","addEventListener","audioAnalyser","initializeAudioContext","classList","toggle","document","getElementById","audioCtx","suspend","style","transform","muted","resume","then","updateVolumeBar","centerVideo","canPlayType","src","AudioContext","source","createMediaElementSource","analyser","createAnalyser","smoothingTimeConstant","connect","destination","fftSize","dataArray","Uint8Array","frequencyBinCount","getByteFrequencyData","volumePercent","draw","state","requestAnimationFrame","parseInt","Math","max","apply","setAttribute","centerX","body","clientWidth","centerY","clientHeight","videoStyle","window","getComputedStyle","boundingRect","getBoundingClientRect","transformOrigin","getPropertyValue","match","pictureCenter","x","parseFloat","y","newTranslateValue","webkitAudioContext","alert"],"mappings":"aAAA,SAAAA,UAAAC,EAAAC,GACA,GAAAC,IAAAC,cAAA,CACA,IAAAC,EAAA,IAAAF,IACAE,EAAAC,WAAAJ,GACAG,EAAAE,YAAAN,GACAI,EAAAG,GAAAL,IAAAM,OAAAC,gBAAA,WACAT,EAAAU,SAGA,IAAAC,GAAA,EAEAX,EAAAY,iBAAA,QAAA,WACAZ,EAAAa,eACAC,uBAAAd,GAEAA,EAAAe,UAAAC,OAAA,4BACAC,SAAAC,eAAA,kBAAAH,UAAAC,OAAA,yBACAL,GASAX,EAAAa,cAAAM,SAAAC,UACApB,EAAAqB,MAAAC,UAAA,GACAtB,EAAAuB,OAAA,EACAZ,GAAA,IAXAA,GAAA,EACAX,EAAAa,cAAAM,SAAAK,SAAAC,KAAA,WACAC,gBAAA1B,KAGAA,EAAAuB,OAAA,EACAI,YAAA3B,WAQAA,EAAA4B,YAAA,mCACA5B,EAAA6B,IAAA,2DACA7B,EAAAY,iBAAA,iBAAA,WACAZ,EAAAU,UAKA,IAAAI,uBAAA,SAAAd,GACAA,EAAAa,cAAA,GACAb,EAAAa,cAAAM,SAAA,IAAAW,aACA,IAAAC,EAAA/B,EAAAa,cAAAM,SAAAa,yBAAAhC,GACAA,EAAAa,cAAAoB,SAAAjC,EAAAa,cAAAM,SAAAe,iBACAlC,EAAAa,cAAAoB,SAAAE,sBAAA,GACAJ,EAAAK,QAAApC,EAAAa,cAAAoB,UACAjC,EAAAa,cAAAoB,SAAAG,QAAApC,EAAAa,cAAAM,SAAAkB,aACArC,EAAAa,cAAAoB,SAAAK,QAAA,GAEAtC,EAAAa,cAAA0B,UAAA,IAAAC,WAAAxC,EAAAa,cAAAoB,SAAAQ,mBACAzC,EAAAa,cAAAoB,SAAAS,qBAAA1C,EAAAa,cAAA0B,WACAvC,EAAAa,cAAA8B,cAAA,GAGAjB,gBAAA,SAAA1B,IACA,SAAA4C,IACA,YAAA5C,EAAAa,cAAAM,SAAA0B,QAEAC,sBAAAF,GAEA5C,EAAAa,cAAAoB,SAAAS,qBAAA1C,EAAAa,cAAA0B,WACAvC,EAAAa,cAAA8B,cAAAI,SAAAC,KAAAC,IAAAC,MAAA,KAAAlD,EAAAa,cAAA0B,WAAA,IAAA,KACAtB,SAAAC,eAAA,UAAAiC,aAAA,KAAAnD,EAAAa,cAAA8B,cAAA,MAGAC,IAGAjB,YAAA,SAAA3B,GACA,IAAAoD,EAAAnC,SAAAoC,KAAAC,YAAA,EACAC,EAAAtC,SAAAoC,KAAAG,aAAA,EAAA,GAEAC,EAAAC,OAAAC,iBAAA3D,GACA4D,EAAA5D,EAAA6D,wBACAC,EAAAL,EAAAM,iBAAA,oBAAAC,MAAA,eAEAC,EAAA,CAAAL,EAAAM,EAAAC,WAAAL,EAAA,IAAAF,EAAAQ,EAAAD,WAAAL,EAAA,KACAO,EAAAA,cAAAjB,EAAAa,EAAA,IAAA,QAAAV,EAAAU,EAAA,IAAA,iBACAjE,EAAAqB,MAAAC,UAAA+C,GAGAvC,aAAA4B,OAAA5B,cAAA4B,OAAAY,mBACAxC,cAAAyC,MAAA,6CAEAxE,UACAkB,SAAAC,eAAA,WACA,kGAGAnB,UACAkB,SAAAC,eAAA,WACA,gGAGAnB,UACAkB,SAAAC,eAAA,WACA,gGAGAnB,UACAkB,SAAAC,eAAA,WACA,iGCtGAD,SAAAC,eAAA,kBAAAN,iBAAA,QAAA,WACAK,SAAAC,eAAA,WAAAH,UAAAC,OAAA","file":"video.min.js","sourcesContent":["function initVideo(video, url) {\r\n    if (Hls.isSupported()) {\r\n        var hls = new Hls();\r\n        hls.loadSource(url);\r\n        hls.attachMedia(video);\r\n        hls.on(Hls.Events.MANIFEST_PARSED, function () {\r\n            video.play();\r\n        });\r\n\r\n        let isActive = false;\r\n\r\n        video.addEventListener('click', () => {\r\n            if(!video.audioAnalyser) {\r\n                initializeAudioContext(video);\r\n            }\r\n            video.classList.toggle(\"video-page__video_opened\");\r\n            document.getElementById('video-controls').classList.toggle(\"video-controls_opened\");\r\n            if (!isActive) {\r\n                isActive = true;\r\n                video.audioAnalyser.audioCtx.resume().then(() => {\r\n                    updateVolumeBar(video);\r\n                });\r\n                \r\n                video.muted  = false;\r\n                centerVideo(video);\r\n            } else {\r\n                video.audioAnalyser.audioCtx.suspend();\r\n                video.style.transform = \"\";\r\n                video.muted  = true;\r\n                isActive = false;\r\n            }\r\n        })\r\n    } else if (video.canPlayType('application/vnd.apple.mpegurl')) {\r\n        video.src = 'https://video-dev.github.io/streams/x36xhzz/x36xhzz.m3u8';\r\n        video.addEventListener('loadedmetadata', function () {\r\n            video.play();\r\n        });\r\n    }\r\n}\r\n\r\nconst initializeAudioContext = (video) => {\r\n    video.audioAnalyser = {};\r\n    video.audioAnalyser.audioCtx = new AudioContext();\r\n    const source = video.audioAnalyser.audioCtx.createMediaElementSource(video);\r\n    video.audioAnalyser.analyser = video.audioAnalyser.audioCtx.createAnalyser();\r\n    video.audioAnalyser.analyser.smoothingTimeConstant = 0.9;\r\n    source.connect(video.audioAnalyser.analyser);\r\n    video.audioAnalyser.analyser.connect(video.audioAnalyser.audioCtx.destination);\r\n    video.audioAnalyser.analyser.fftSize = 32;\r\n\r\n    video.audioAnalyser.dataArray = new Uint8Array(video.audioAnalyser.analyser.frequencyBinCount);\r\n    video.audioAnalyser.analyser.getByteFrequencyData(video.audioAnalyser.dataArray);\r\n    video.audioAnalyser.volumePercent = 0;\r\n}\r\n\r\nconst updateVolumeBar = (video) => {\r\n    const draw = () => {\r\n        if (video.audioAnalyser.audioCtx.state !== 'running') return;\r\n\r\n        requestAnimationFrame(draw);\r\n        \r\n        video.audioAnalyser.analyser.getByteFrequencyData(video.audioAnalyser.dataArray);\r\n        video.audioAnalyser.volumePercent = parseInt(Math.max.apply(null, video.audioAnalyser.dataArray) / 255 * 100);\r\n        document.getElementById('volume').setAttribute('x2', `${video.audioAnalyser.volumePercent}%`);\r\n    }\r\n\r\n    draw();\r\n}\r\n\r\nconst centerVideo = (video) => {\r\n    var centerX = document.body.clientWidth / 2;\r\n    var centerY = document.body.clientHeight / 2 - 55;\r\n\r\n    const videoStyle = window.getComputedStyle(video);\r\n    const boundingRect = video.getBoundingClientRect();\r\n    let transformOrigin = videoStyle.getPropertyValue('transform-origin').match(/\\d+(.\\d+)?/g);\r\n\r\n    const pictureCenter = [boundingRect.x + parseFloat(transformOrigin[0]), boundingRect.y + parseFloat(transformOrigin[1])];\r\n    const newTranslateValue = `translate(${centerX - pictureCenter[0]}px, ${centerY - pictureCenter[1]}px) scale(2.8)`;\r\n    video.style.transform = newTranslateValue;\r\n}\r\n\r\nconst AudioContext = window.AudioContext || window.webkitAudioContext;\r\nif (!AudioContext) alert('Ваш браузер не поддерживает Web Audio API');\r\n\r\ninitVideo(\r\n    document.getElementById('video-1'),\r\n    'http://localhost:9191/master?url=http%3A%2F%2Flocalhost%3A3102%2Fstreams%2Fsosed%2Fmaster.m3u8'\r\n);\r\n\r\ninitVideo(\r\n    document.getElementById('video-2'),\r\n    'http://localhost:9191/master?url=http%3A%2F%2Flocalhost%3A3102%2Fstreams%2Fcat%2Fmaster.m3u8'\r\n);\r\n\r\ninitVideo(\r\n    document.getElementById('video-3'),\r\n    'http://localhost:9191/master?url=http%3A%2F%2Flocalhost%3A3102%2Fstreams%2Fdog%2Fmaster.m3u8'\r\n);\r\n\r\ninitVideo(\r\n    document.getElementById('video-4'),\r\n    'http://localhost:9191/master?url=http%3A%2F%2Flocalhost%3A3102%2Fstreams%2Fhall%2Fmaster.m3u8'\r\n);","document.getElementById(\"toggle-sidebar\").addEventListener(\"click\", () => {\r\n    document.getElementById(\"sidebar\").classList.toggle(\"sidebar_opened\");\r\n})"]}