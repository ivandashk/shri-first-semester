"use strict";var appendDiv=function(e){var a=document.createElement("div");return e.appendChild(a),a},getIconThemeByEventType=function(e,a){return isCritical(a)?e+"-white":e},isCritical=function(e){return"critical"===e},hasAttachedImage=function(e){return!!e.data&&(!!e.data.image||!!e.data.type&&"graph"===e.data.type)},createCard=function(){var e=document.getElementById("ribbon"),a=appendDiv(e);return a.classList.add("card"),a},setSize=function(e,a){a.classList.add("card_"+e.size)},setType=function(e,a){isCritical(e.type)&&a.classList.add("card_critical"),hasAttachedImage(e)&&a.classList.add("card_with-image")},setCardHeader=function(e,a){var t=appendDiv(a);t.classList.add("card__row");var n=document.createElement("img");n.classList.add("card__image","card__image_icon");var r=getIconThemeByEventType(e.icon,e.type);n.src="./images/"+r+".svg",t.appendChild(n);var i=appendDiv(t);i.innerHTML=trimTitle(e.title,e.size),i.classList.add("card__title");var s=document.createElement("img");s.classList.add("card__close"),r=getIconThemeByEventType("cross",e.type),s.src="./images/"+r+".svg",t.appendChild(s)},trimTitle=function(e,a){var t=void 0;switch(a){case"l":case"m":t=50;break;case"s":t=20}return e.length<t?e:e.slice(0,t)+"..."},setBasicInfo=function(e,a){var t=appendDiv(a);t.classList.add("card__basic-info"),"s"===e.size&&t.classList.add("card__basic-info_s"),isCritical(e.type)&&t.classList.add("card__basic-info_with-bottom-margin"),appendDiv(t).innerHTML=e.source,appendDiv(t).innerHTML=e.time},appendCriticalDetails=function(e){var a=appendDiv(e);return a.classList.add("card__details"),a},appendDescription=function(e,a){if(e.description){var t=appendDiv(a);"l"===e.size&&t.classList.add("card__description_l"),isCritical(e.type)||t.classList.add("card__description"),t.innerHTML=e.description}},appendPlayer=function(e,a){if("music"!==!e.icon&&e.data&&e.data.track){var t=document.getElementById("player");t.content.querySelector(".player__logo").src=e.data.albumcover,t.content.querySelector(".player__name").innerHTML=e.data.artist+" - "+e.data.track.name,t.content.querySelector(".player__value_time").innerHTML=e.data.track.length,t.content.querySelector(".player__value_volume").innerHTML=e.data.volume+"%";var n=document.importNode(t.content,!0);a.appendChild(n)}},appendAttachedImage=function(e,a){if(hasAttachedImage(e)){var t=appendDiv(a);if(t.classList.add("card__image-container"),"cam"===e.icon){var n=appendDiv(t);n.setAttribute("id","camera"),n.setAttribute("touch-action","none"),n.classList.add("card__image_camera");var r=document.createElement("progress");r.setAttribute("id","camera-progress"),r.classList.add("card__camera-interface","card__progress"),r.setAttribute("max","100"),r.setAttribute("value","50"),t.appendChild(r)}else{var i=document.createElement("img");i.classList.add("card__image","card__image_attachement"),i.src="./images/Richdata@3x.png",i.srcset="./images/Richdata.png 590w, ./images/Richdata@2x.png 1080w, ./images/Richdata@3x.png 1770w",i.sizes="(max-width: 650px) 560px, (max-width: 910px) 910px, 1100px",t.appendChild(i)}}},appendButtons=function(e,a){if(e.data&&e.data.buttons){var n=appendDiv(a);n.classList.add("card__row"),e.data.buttons.forEach(function(e,a){var t=appendDiv(n);t.classList.add("card__button"),0===a&&t.classList.add("card__button_accent"),t.innerHTML=e})}},appendMeasurements=function(n,e){if(n.data&&n.data.temperature&&n.data.humidity){var r=appendDiv(e);r.classList.add("card__measurements");var a=[];n.data.temperature&&a.push(["temperature","Температура:&nbsp;"," C"]),n.data.humidity&&a.push(["humidity","Влажность:&nbsp;","%"]),a.forEach(function(e){var a=document.getElementById("measurement");a.content.querySelector(".measurement__text").innerHTML=e[1],a.content.querySelector(".measurement__value").innerHTML=n.data[e[0]]+e[2];var t=document.importNode(a.content,!0);r.appendChild(t)})}},markLastElementInCard=function(e){1===e.classList.length&&e.classList.contains("card__expander-row")||e.classList.add("card__last-element")},placeExpandButton=function(e){var a=document.createElement("img");a.classList.add("card__expand"),a.src="./images/next.svg";var t=void 0;e.lastElementChild.classList.contains("card__basic-info")?(a.classList.add("card__expand_absolute"),t=e):e.lastElementChild.classList.contains("player")||e.lastElementChild.classList.contains("card__image-container")||e.lastElementChild.classList.contains("card__measurements")?(t=e.lastElementChild.previousElementSibling).classList.add("card__expander-row"):(t=e.lastElementChild).classList.add("card__expander-row"),t.appendChild(a)},appendCameraInterface=function(e){var a=appendDiv(e);a.setAttribute("id","camera-interface"),a.classList.add("card__measurements","card__camera-interface"),appendDiv(a).innerHTML="Приближение: 0%",appendDiv(a).innerHTML="Яркость: 100%"},generateCards=function(e){e.events.forEach(function(e){var a=createCard();setSize(e,a),setType(e,a),setCardHeader(e,a),setBasicInfo(e,a),isCritical(e.type)&&(a=appendCriticalDetails(a)),appendDescription(e,a),appendPlayer(e,a),appendAttachedImage(e,a),appendButtons(e,a),appendMeasurements(e,a),placeExpandButton(a),markLastElementInCard(a.lastElementChild),"cam"===e.icon&&appendCameraInterface(a)})},xhr=new XMLHttpRequest;xhr.open("POST","/api/events",!0),xhr.onreadystatechange=function(){4==this.readyState&&generateCards(JSON.parse(this.response))},xhr.send();var camera=document.getElementById("camera"),cameraInterface=document.getElementById("camera-interface"),cameraProgress=document.getElementById("camera-progress"),isTouchDevice=function(){return"ontouchstart"in document.documentElement},turnGestureInterfaceOn=function(){cameraProgress.classList.add("card__camera-interface_enabled"),cameraInterface.classList.add("card__camera-interface_enabled")},setGestures=function(){var e=window.getComputedStyle(camera),a=parseInt(e.getPropertyValue("background-size").slice(0,-2)),d=[],i="",s=void 0,o=void 0,c=0,l=2,p=a,m=a+500,u=160,_=50,v=3,g={currentBackgroundSize:a,currentPosition:0,currentBrightness:100};camera.addEventListener("pointerdown",function(e){camera.setPointerCapture(e.pointerId),d.push({pointerId:e.pointerId,startX:e.x,startY:e.y,currentBackgroundSize:g.currentBackgroundSize,currentPosition:g.currentPosition}),e.isPrimary||(s=Math.sqrt(Math.pow(d[0].startX-d[1].startX,2)+Math.pow(d[0].startY-d[1].startY,2)))}),camera.addEventListener("pointermove",function(e){switch(i){case"pan":r(e);break;case"pinch":f(e);break;case"rotate":L(e);break;default:t(e)}});var t=function(e){switch(d.length){case 1:r(e);break;case 2:n(e);break;default:console.log("Unrecognized gesture")}},n=function(e){var a=h(e)-s;c++,35<Math.abs(a)?i="pinch":30<c&&(i="rotate")},h=function(e){var a=e.pointerId,t=e.x,n=e.y,r=a!==d[0].pointerId?d[0]:d[1],i=a!==d[0].pointerId?d[1]:d[0];return i.startX=t,i.startY=n,Math.sqrt(Math.pow(t-r.startX,2)+Math.pow(n-r.startY,2))},r=function(e){if(10<++c&&(i="pan"),e.isPrimary){var a=d[0],t=a.startX,n=a.currentPosition,r=e.x-t;n+r<-1*u||u<n+r||(camera.style.backgroundPositionX=n+r+"px",g.currentPosition=n+r,cameraProgress.setAttribute("value",""+(_-g.currentPosition/v)))}},f=function(e){var a=h(e),t=(a-s)*l;s=a;var n=g.currentBackgroundSize+t;if(!(n<p||m<n)){g.currentBackgroundSize=n,camera.style.backgroundSize=n+"px";var r=Math.round((n-p)/(m-p)*100);cameraInterface.firstElementChild.innerHTML="Приближение: "+r+"%"}},L=function(e){var a=e.x,t=e.y,n=e.isPrimary,r=e.pointerId;if(!n){var i=r!==d[0].pointerId?d[0]:d[1],s=Math.atan2(i.startY-t,i.startX-a);o||(o=s);var c=0<s-o?1:-1;o=s,g.currentBrightness+c<0||(g.currentBrightness+=c,camera.style.webkitFilter="brightness("+g.currentBrightness+"%)",cameraInterface.lastElementChild.innerHTML="Яркость: "+g.currentBrightness+"%")}},y=function(e){0!==d.length&&(o=s=void 0,c=0,"pointerup"===e.type&&"rotate"===i?(d.pop(),0===d.length&&(i="")):(d=[],i=""))};camera.addEventListener("pointerup",y),camera.addEventListener("pointercancel",y)};isTouchDevice()&&(turnGestureInterfaceOn(),setGestures());for(var navItems=document.getElementsByClassName("nav__item"),navs=document.getElementsByClassName("nav"),i=0;i<navs.length;i++)navs[i].children[0].classList.toggle("nav__item_active");for(var _i=0;_i<navItems.length;_i++)navItems[_i].addEventListener("click",function(e){for(var a=0;a<e.target.parentNode.children.length;a++)e.target.parentNode.children[a].classList.remove("nav__item_active");e.target.classList.toggle("nav__item_active")});document.getElementById("toggle-sidebar").addEventListener("click",function(){document.getElementById("sidebar").classList.toggle("sidebar_opened")});
//# sourceMappingURL=scripts.min.js.map
