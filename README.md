# ШРИ 2018-2. Домашнее задание

**Запуск**
```
npm i
gulp
```

## Задание 1. Адаптивная верстка

**Задача:** Нужно сверстать страницу ленты событий умного дома. Предоставляется базовый дизайн ленты для экрана. Изменения размеров и компоновки карточек на других размерах экрана необходимо придумать и реализовать самостоятельно. Верстка должна быть максимально адаптивной. Отрисовка ленты с помощью шаблонизатора, т.е. генерация HTML из предоставленного набора данных в формате JSON

**Комментарии к решению.** 
Шаблонизатор карточек находится по пути: src/blocks/card/card-generator.js

- В качестве основы для ленты используется грид с 6ю колонками для десктопа, с постепенным уменьшением сначала до 5, затем до 4х колонок. В мобильной версии, грид заменяется на flexbox.
- Место расположения кнопки расширения карточки, которая появляется при ховере, определяется динамически в зависимости от контента внизу карточки. При возникновении коллизий, кнопка поднимается выше.
- В процессе шаблонизации применяется смешанный метод: сборка с нуля через js + использование template тэгов (блоки player и measurements)
- Подключение внешних данных events происходит через тэг script до шаблонизатора. Файл находится в папке docs/ и был модифицирован добавлением const data = {данные}.
- Ссылка на авторские права на изображения находится в футере в разделе Авторские права (Лицензия)
- Адаптивность изображений присутствует на примере графика Richdata.png
- Так как интерфейс не зуммируется, решил не использовать адаптивную типографику для пропорциональности элементов согласно дизайн-макету.

**Как можно доработать** 
1. Заменить способ обрезки двустрочных заголовков многоточием. Сейчас неадаптивное решение - обрезка на основе количества символов при создании карточки. К тому же, не учитывается символ, на котором было перенесено слово на первой строке, ужасно. Можно при событии resize окна считать на основе высоты контейнера заголовка, но хотелось бы узнать есть ли метод лучше/производительнее.
2. На карточке "Изменен климатический режим" строка "Влажность: 80%" располагается не в соответствии с дизайн-макетом на десктопе
3. Улучшить отображение слайдеров в Edge
4. Возможен некорректный вид карточек, содержащий другие конфигурации контента и компоновки.
5. Исправить размер кнопки "Расширить" на карточках в Firefox. Сейчас или явном задании размеров либо расширяется сама карточка, либо стрелочку необходимо расположить чуть выше, что не будет соответствовать дизайн-макету.

## Задание 2. Работа с сенсорным пользовательским вводом

**Задача:** При использовании сенсорного устройства на карточке с камерой необходимо реализовать:
- Движение пальцем влево-вправо позволяет перемещаться по картинке - поворот камеры 
- Pinch позволяет приблизить или отдалить картинку
- Поворот изменяет яркость изображения
- Появление на карточке соответсвующих индикаторов согласно дизайн-макету

**Комментарии к решению.**
Путь к скрипту с решением: src/blocks/card/gestures-camera.js

Решение построено на предпосылке, что после того, как начинается жест, в течение следующих нескольких движений, 
необходимо его окончательно распознать.
После этого, мы фиксируемся на данном жесте и не позволяем пользователю переключаться на другой жест до окончания текущего. 

Из данной предпосылки вытекают следующие особенности:
1. Движение "pan" начинается сразу, как только регистрируется движение с одним указателем, но не фиксируется. 
В течение нескольких следующих движений пользователю дается время, чтобы поставить второй палец и переключиться на двухпальцевый жест.
2. В начале двухпальцевого жеста, пропускаем несколько движений указателей "вхолостую" для его распознания. Если в течение серии движений
указатели удалились друг от друга более, чем на величину, определенную эмпирическим путем, жест - "pinch". Если движения происходят,
а удаление указателей друг от друга не наблюдается, предполагаем, что это "rotate".
3. При выполнении движения "rotate", фиксация на данном жесте сохраняется до тех пор, пока не будут отпущены все указатели.
Это сделано для того, чтобы можно было отпустить второй палец, переставить его на новое место и продолжить выполнять данное движение.

**Как можно доработать** 
1. После зуммирования, сейчас паномарируется не все изображение, а только центральная его часть.
2. Если движение "pinch" выполняется слишком медленно (расстояние между указателями не успевает превысить некоторую величину), 
движение будет распознано как "rotate".

## Задание 3. Мультимедиа

**Задача:**  
На странице должна находиться сетка из 4-х видео-превью. Клик по превью разворачивает соответствующее видео на всю страницу. Анимацию разворачивания видео можно сделать по аналогии с маковским приложением Photo Booth. Когда видео раскрыто на всю страницу, в интерфейсе нужно предусмотреть кнопку "Все камеры", которая позволяет вернуться назад. Анимация переключения видео должна работать без тормозов (без просадки FPS на странице).  
Видео-поток с камеры может быть плохого качества (размытый, засвеченный или затемненный) - добавьте на экран просмотра видео возможность регулировать его яркость и контрастность. Для контролов настройки яркости/контрастности можете реиспользовать слайдеры из вашего вступительного задания, либо просто используйте input (реализация контрола не будет оцениваться дополнительно).  
Реализуйте анализатор громкости звука в потоке из открытой камеры (в виде столбчатой диаграммы).

**Бонусные задания**  
Добавьте информацию об уровне освещенности в комнате, в которой стоит камера.
Реализуйте детектор движения в видео-потоке (нарисуйте поверх видео прямоугольник, ограничивающий область, в которой происходит движение). Работа анализаторов не должна давать серьезных просадок FPS.

**Комментарии к решению.**  
Материалы по данному заданию находятся в следующей директории: src/blocks/video-page/
Для запуска, необходимо запустить сначала сервер с видеопотоками, инструкция по [ссылке](https://github.com/mad-gooze/shri-2018-2-multimedia-homework/blob/master/streams/README.md). После чего в репозитории данного проекта
```
gulp
```

- Фильтры яркости и контрастности выполнены при помощи CSS-фильтров
- Элементы управления являются общими для всех видео и привязаны к настройкам того видео, которое сейчас активно.
- Графики уровней громкости и освещенности оригинального кадра выполнены с помощью столбчатых диаграмм на svg.
- Уровень громкости в кадре считается по пиковому значению графика распределения частот (функции initializeAudioContext() для инициализации и updateVolumeBar() для обновления).
- Доп. задание: Уровень освещенности оригинального кадра считается через канвас по среднему уровню грейскейла каждого кадра (функция measureFrameBrightness())

**Как можно доработать** 
1. Сделать решение более адаптивным. Сейчас десктопная версия корректно отображается при высоте экрана >930px (отсутствует вертикальный скролл). В мобильной версии можно увеличивать величину скейла активного видео в зависимости от текущей ширины экрана пользователя.
2. В мобильной версии накладывать оверлей, который запрещает выбор другого видео, что приводит к багам.

## Задание 4. Node.js
Для просмотра решения, необходимо переключиться на ветку 4-nodejs

**Задача:** 
Написать сервер на express который будет подниматься на 8000 порту и обрабатывать два роута: 
1. /status — должен выдавать время, прошедшее с запуска сервера в формате hh:mm:ss 
2. /api/events — должен отдавать содержимое файла events.json. При передаче get-параметра type включается фильтрация по типам событий. При передаче некорректного type — отдавать статус 400 "incorrect type". (/api/events?type=info:critical) 
3. Все остальные роуты должны отдавать 
```
<h1>Page not found</h1>
```
с корректным статусом 404.

**Доп. задания**  
Перейти на POST-параметры.  
Подключить данные к вёрстке из первого задания.  
Сделать пагинацию событий — придумать и реализовать API, позволяющее выводить события постранично.  

**Комментарии к решению.**  
Запуск 
```
nodemon server\server.js
```

- Все доп. задания выполнены
- Страница с карточками из первого задания доступна по адресу http://localhost:8000/, карточки получаются запросом на сервер.
- Реализована обработка ошибок некорректных значений параметров
- Пагинация реализована в виде параметра page. Размер страницы - 3 элемента, нумерация начинается с индекса 0. Таким образом, запрос /api/events?type=info&page=1 отдаст с 3го по 6й элемент типа info 

API-тесты (тестировал при помощи [Insomnia](https://insomnia.rest/download/)):  
- GET http://localhost:8000/  
- GET http://localhost:8000/notfound  
- GET http://localhost:8000/status  
- POST http://localhost:8000/api/events  
- POST http://localhost:8000/api/events?type=info  
- POST http://localhost:8000/api/events?type=critical  
- POST http://localhost:8000/api/events?type=info:critical  
- POST http://localhost:8000/api/events?type=incorrect  
- POST http://localhost:8000/api/events?page=1  
- POST http://localhost:8000/api/events?page=1&type=info  
- POST http://localhost:8000/api/events?page=100  
- POST http://localhost:8000/api/events?page=10a  

